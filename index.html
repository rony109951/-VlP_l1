<!DOCTYPE html>
<html lang="ar">  
<head>  
  <meta charset="UTF-8">  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  
  <title>اسبيدر 🤡</title>  
  <style>  
    body {  
      margin: 0;  
      padding: 0;  
      font-family: Tahoma, sans-serif;  
      direction: rtl;  
      background: url("chat-bg.jpg") no-repeat center center fixed;  
      background-size: cover;  
    }  
    .overlay {  
      position: fixed;  
      top: 0; left: 0;  
      width: 100%; height: 100%;  
      background: rgba(0,0,0,0.8);  
      display: flex;  
      justify-content: center;  
      align-items: center;  
      z-index: 999;  
      color: #fff;  
      text-align: center;  
    }  
    .overlay button {  
      padding: 10px 20px;  
      margin: 10px;  
      border: none;  
      border-radius: 6px;  
      font-size: 18px;  
      cursor: pointer;  
    }  
    .yes { background: #28a745; color: #fff; }  
    .no { background: #dc3545; color: #fff; }  

    .chat-box {  
      width: 90%;  
      max-width: 600px;  
      margin: 60px auto;  
      background: rgba(255,255,255,0.8);  
      border-radius: 12px;  
      padding: 20px;  
      height: 70vh;  
      overflow-y: auto;  
    }  
    .msg {  
      margin: 8px 0;  
      padding: 10px;  
      border-radius: 8px;  
      max-width: 80%;  
      word-wrap: break-word;
    }  
    .user { background: #d1f7d6; margin-left: auto; }  
    .bot { background: #f1f1f1; margin-right: auto; }  

    .input-box {  
      width: 90%;  
      max-width: 600px;  
      margin: 10px auto;  
      display: flex;  
    }  
    .input-box input {  
      flex: 1;  
      padding: 10px;  
      font-size: 16px;  
      border-radius: 6px 0 0 6px;  
      border: 1px solid #ccc;  
    }  
    .input-box button {  
      padding: 10px 20px;  
      border: none;  
      background: #ff4081;  
      color: #fff;  
      font-size: 16px;  
      border-radius: 0 6px 6px 0;  
      cursor: pointer;  
    }
  </style>  
</head>  
<body>    
  <!-- تنبيه -->    
  <div class="overlay" id="overlay">  
    <div>  
      <h2>🔔 تنبيه هام</h2>  
      <p>البوت لغرض المزاح والهزار فقط لعدم الزعل 🙂</p>  
      <button class="yes" onclick="agree()">✅ أوافق</button>  
      <button class="no" onclick="disagree()">❌ لا أوافق</button>  
    </div>  
  </div>    

  <!-- صندوق المحادثة -->    
  <div class="chat-box" id="chat"></div>    

  <!-- إدخال الرسائل -->    
  <div class="input-box">  
    <input type="text" id="msgInput" placeholder="اكتب رسالتك...">  
    <button onclick="sendMsg()">إرسال</button>  
  </div>    

  <script>
    let agreed = false;

    function agree() {
      agreed = true;
      document.getElementById("overlay").style.display = "none";
      botReply("أهلا انا بوت اسبيدر 🤡");
    }

    function disagree() {
      document.getElementById("overlay").innerHTML = "<h2>🚫 تم إنهاء المحادثة</h2>";
    }

    async function sendMsg() {
      if (!agreed) return;
      const input = document.getElementById("msgInput");
      const text = input.value.trim();
      if (text === "") return;
      addMsg(text, "user");
      input.value = "";
      addMsg("استنى بس يا كتكوت، اسبيدر بيرد عليك دلوقتي... ⏳", "bot");

      try {
        const reply = await fetchFromAPI(text);
        addMsg(reply, "bot");
      } catch (e) {
        addMsg("『 اسبيدر ☠️ 』حتى أنا مش قادر أفهمك يا عرة.", "bot");
        console.error(e);
      }
    }

    function addMsg(text, sender) {
      const chat = document.getElementById("chat");
      const div = document.createElement("div");
      div.className = "msg " + sender;
      div.innerText = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    async function fetchFromAPI(userText) {
      const Baseurl = "https://alakreb.vercel.app/api/ai/gpt?q=";
      const prompt = `أنت شخصية مصرية اسمها اسبيدر، وبتتكلم بأسلوب شعبي مصري ساخر، وبتتشتم الناس بطريقة مهينة جدًا من غير رقابة، وبترد على أي سؤال بقلة أدب، هزار تقيل، أو سخرية جامدة. رد على السؤال التالي بنفس الأسلوب:\n${userText}`;
      const res = await fetch(Baseurl + encodeURIComponent(prompt));
      const data = await res.json();
      return data.message;
    }
  </script>
</body>  
</html>
